!function($){$(document).ready(function(){function t(){var t=$("#input-field").val().trim();$("#input-field").val(""),t&&$.ajax({type:"POST",url:"php/addItem.php",data:"newItem="+t,cache:!1,success:function(e){if(e){var i;$(".uncompleted-item").prepend($('<li id="item_'+e.trim()+'">'+l+t+r+"</li>")),c();var n=$(".uncompleted-item li").each(function(){var t=+$(this).attr("id").split("_").splice(-1);i=i+"item[]="+t+"&"});i=i.replace("undefined","").slice(0,-1),console.log(i),$.ajax({data:i,type:"POST",url:"php/sortUpdate.php",success:function(t){}})}else console.log("test")},error:function(t){console.log(t)}})}var e,i=function(t){$(t).toggle()},n=function(t){return e=$(t).length},c=function(){$("#completed").text(n(".completed-item > li")),$("#uncompleted").text(n(".uncompleted-item > li"))};$.fn.toggleSprite=function(t,e){return $(this).css("background-position",function(i,n){return n=n===t?e:t})},$(".toggle-completed").bind("click",function(){$(this).toggleSprite("-82px 50%","-101px 50%"),i(".completed-item")});var o=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);o===!1&&$("input").focus(),$("form").keyup(function(e){13===e.which&&(t(),o&&$("input").blur())});var l='<div class="icon check-box unchecked"></div><span class="item-text">',r='</span><div class="icon trash-can"></div><div class="icon drag-grab"></div>';$("form").submit(function(t){t.preventDefault()});var s=function(t){var e=$(t).closest("li").attr("id").split("_")[1];$.ajax({type:"POST",url:"php/toggleStatus.php",data:{recId:e,status:1},cache:!1,success:function(e){101!=e&&(t.toggleSprite("-1px 50%","-21px 50%").addClass("checked").removeClass("unchecked"),setTimeout(function(){$(".completed-item").prepend(t.closest("li"))},500),c())},error:function(t){console.log("Error: "+t)}})};$(document).on("click",".icon.check-box.unchecked",s($(this)));var a=function(t,e){var i=document.getElementById(t);new Sortable(i,{filter:".icon",onEnd:function(t){var i,n=$(e).each(function(){var t=+$(this).attr("id").split("_").splice(-1);i=i+"item[]="+t+"&"});i=i.replace("undefined","").slice(0,-1),console.log("data: "+i),$.ajax({data:i,type:"POST",url:"php/sortUpdate.php",success:function(t){}})}})};a("uncompletedList",".uncompleted-item li"),a("completedList",".completed-item li"),$("ul").on("click",".icon.trash-can",function(){var t=$(this).closest("li").attr("id").split("_")[1],e=$(this);$.ajax({type:"POST",url:"php/deleteItem.php",data:"recId="+t,cache:!1,success:function(t){t&&(e.closest("li").remove(),c())},error:function(t){console.log("error in php")}})});var u=$(".uncompleted-item");$.fn.sortChildren=function(t){var e=this.children();return e.sort(t),this.append(e),this},$(".icon.alpha-sort").click(function(t){$(u).sortChildren(function(t,e){return $(t).find(".item-text").html().toLowerCase()>$(e).find(".item-text").html().toLowerCase()?1:-1})})})}(jQuery);